/* bitbit, a bitboard based chess engine written in c.
 * Copyright (C) 2022-2024 Isak Ellmer
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License, version 2 as
 * published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

#include "evaluate.h"

#include <string.h>

#ifndef NDEBUG
int tables_init_done = 0;
#endif

score_t psqtable[2][7][64];

score_t piece_value[6] = { S(  97, 144), S( 491, 513), S( 514, 562), S( 609, 928), S(1374,1734), };

/* From white's perspective, files a to d on a regular board. */
score_t white_psqtable[6][64] = {
	{ /* Pawn. */
		S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
		S( 19, -7), S(  3, -1), S(  3, -9), S( 24, 13), S( 28,  8), S( -8,  0), S(-14,  7), S(  2,  1),
		S( 22, 14), S( -2, 10), S( -4,  8), S( 23, -2), S( 17, -4), S( 14,  5), S( -9, 12), S(  1,  6),
		S(  5, 14), S(  4,  8), S(  5, -3), S( 17, -8), S( 20, -8), S( 15,  0), S( 18,  9), S( -1, 13),
		S( -8,  0), S(-12, 12), S( 13, -5), S( 16, -8), S( 12,-11), S( 13, -1), S( -5, 11), S(-12, -1),
		S(-14, -7), S(-12,  1), S( -6, -3), S( -6, -2), S(  1,  0), S( -6, -1), S( 12, -5), S( -5,-13),
		S(-21,  0), S(  1,  5), S( -5,  3), S(-15,  2), S(-11,  6), S(  7,  5), S( 17,  1), S( -7,-12),
		S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
	}, { /* Knight. */
		S(-93,-69), S(-65, -4), S(-99,  9), S(-19,  0),
		S( -3, -6), S( -4,  2), S( 13, -5), S(  8,  2),
		S(  1, -6), S( 11, -6), S( 14,  8), S( 37,  5),
		S( 29,  3), S( 22, 12), S( 20, 13), S( 28, 23),
		S(  8,  7), S(  6,  6), S( 20,  8), S( 12, 23),
		S( -5, -7), S(  6, -7), S(  2,  0), S( 11,  9),
		S(-17,-19), S( -4, -9), S( -3, -7), S( -5,  3),
		S(-37,-16), S(-27,-27), S(-31,-10), S(-12, -2),
	}, { /* Bishop. */
		S(-22,-14), S(-40, 15), S(-62,  8), S(-35,  3),
		S(-22,  4), S(-27,  2), S(-10,  7), S(-27,  5),
		S(  0, -2), S( -6,  9), S(  6,  5), S( 18,  0),
		S(  1, -2), S(  7,  6), S(  5,  3), S( 18, 11),
		S(  2,-14), S( -3, -7), S(  8,  4), S( 14,  7),
		S(  9,  3), S( 25, -9), S(  4,-10), S(  8,  8),
		S( 10,  3), S(  9,-18), S(  9, -5), S( -1,  2),
		S(-19, -2), S( -2,  3), S(-21,  0), S(-19,  2),
	}, { /* Rook. */
		S( 25, 18), S( 12, 25), S( 36, 18), S( 20, 14),
		S( 14,  8), S(  6,  9), S( 37,  1), S( 33,  2),
		S( -4, 10), S(  9,  8), S( 22,  1), S( 37, -3),
		S(  0, 15), S( -7, 18), S( 26,  8), S( 19,  8),
		S(-15,  8), S(-22, 12), S( -6,  7), S(  5,  0),
		S(-18, -4), S(-10, -6), S(-16, -1), S( -2, -8),
		S(-39,-11), S( -1,-15), S(  6,-15), S(  8,-13),
		S( -1, -8), S( -5, -4), S( 11,-10), S( 18,-11),
	}, { /* Queen. */
		S(-26, 13), S(-25, 11), S(  3,  6), S( 10,  9),
		S(-10, 15), S(-17, 25), S( -6, 33), S(-11, 30),
		S( -1,  4), S(-10, 35), S( -2, 41), S( -4, 31),
		S(  7, 20), S(-14, 49), S( -7, 42), S(-15, 64),
		S(  3,  3), S( -3, 35), S( -8, 33), S(-16, 49),
		S(  6,-12), S(  9, -5), S(  1,  5), S(  1,  5),
		S( -7,-31), S(  9,-51), S( 12,-52), S(  5,-19),
		S(  3,-36), S(-10,-55), S( -9,-75), S(  5,-67),
	}, { /* King. */
		S(-65,-80), S( 49, 36), S( 27, 36), S(  1, 39),
		S(-15, -8), S(  6, 54), S( 21, 39), S(  9, 32),
		S(-16, 26), S(  6, 57), S( 37, 38), S(  9, 32),
		S( -3, 14), S( 10, 35), S(  5, 25), S( 19, 27),
		S(-28, -6), S(  1, 13), S(  8,  6), S( -2, 15),
		S(-26, -6), S( -6,  7), S(-10,  1), S(-23,  6),
		S( -4,-10), S(-25,  6), S(-11, -5), S(-29, -2),
		S( 13,-41), S(  9,-15), S( 14,-30), S( 13,-41),
	}
};

score_t mobility[4][28] = {
        {
                S(-27,-35), S(-32,-75), S(-16,-40), S( -9,-12), S(  1, -3), S(  7, 15), S( 13, 18), S( 22, 24), S( 28, 16),
        }, {
                S(-24,-42), S(-35,-81), S(-18,-48), S( -6,-24), S(  2,-11), S(  7,  4), S( 10, 14), S( 13, 17), S( 16, 21),
                S( 18, 24), S( 16, 25), S( 29, 21), S( 24, 30), S( 37, 19),
        }, {
                S(-54,-98), S(-27,-90), S( -7,-44), S( -3,-28), S( -6,-27), S( -1,-15), S( -1, -3), S(  3,  2), S(  5,  5),
                S(  9, 12), S( 13, 17), S( 18, 20), S( 23, 26), S( 26, 28), S( 43, 17),
        }, {
                S( -6,  6), S( -2,-23), S(-18,-31), S(-16,-65), S(-13,-79), S( -9,-78), S( -5,-70), S( -3,-49), S( -2,-30),
                S( -1,-10), S(  2,  2), S(  4,  7), S(  5, 13), S(  9, 12), S(  8, 18), S(  6, 25), S(  8, 25), S(  7, 28),
                S(  5, 25), S(  6, 17), S(  4, 22), S( 18, 15), S( 16, 15), S( 11,  0), S( 20,  1), S(  4,  7), S( -7, -7),
                S(  7,  5),
        }
};

score_t pawn_shelter[28] = {
        S(  9,-23), S( 51,-43), S( 59,-32), S( 43,-18), S( 22, -5), S( 43,  8), S( 25, 30),
        S( -7, 16), S( 57, -2), S( 42, -1), S( 20, 10), S( 22, 23), S( 28, 35), S( 75, 43),
        S( 12, 29), S( 57, 25), S( 34, 33), S( 25, 31), S( 18, 46), S(  9, 52), S( 16, 58),
        S(-21, 30), S(  3, 31), S( -2, 27), S(-14, 36), S(-18, 37), S(-80, 41), S(-80, 39),
};

score_t unblocked_storm[28] = {
        S( -7, -3), S( 93,360), S(-53, 93), S(-50, 19), S(-29, 24), S(-12,  4), S(-20,  1),
        S(-41, 24), S(203,217), S(-91, 25), S(-73, 37), S(-68, 30), S(-50, 12), S(-59, 14),
        S(-15, -8), S(-101, 55), S(-14, -2), S(-53,-10), S(-40,-19), S(-32,-24), S(-27,-28),
        S(-11, 14), S(-93, 54), S(  2, 34), S(-55, -8), S(-37,-11), S(-18,-13), S(-21,-13),
};

score_t unblockable_storm[28] = {
        S(-40, 12), S(101,146), S( 19, 92), S(-38, 66), S(-24, 42), S(  0, 32), S( -9, 23),
        S(-69,  6), S(-16,133), S(-48, 65), S(-44, 33), S(-61, 28), S(-34, 15), S(-42, 14),
        S(-35,-31), S(-77, 53), S(-65, 23), S(-58,  0), S(-37,-12), S(-21,-22), S(-22,-26),
        S(-36, -7), S(-64, 74), S(-39, 11), S(-42, -8), S(-45, -5), S(-26, -3), S(-21,-15),
};

score_t blocked_storm[28] = {
        S(  0,  0), S(-61, -6), S( -1, -7), S( -5, -1), S(  2,-12), S(-29, -5), S(  0,  0),
        S(  0,  0), S(-98,-53), S(-42, -2), S(-52, -2), S(-51,-13), S(-52, -7), S(  0,  0),
        S(  0,  0), S(-109,-18), S(-41,-29), S(-15,-45), S(-22,-53), S(-30,-44), S(  0,  0),
        S(  0,  0), S(-92,-43), S(-25,-20), S(-19,-24), S(-10,-19), S( 17,-35), S(  0,  0),
};

void tables_init(void) {
	memset(psqtable, 0, sizeof(psqtable));
	for (int turn = 0; turn < 2; turn++) {
		for (int piece = PAWN; piece <= KING; piece++) {
			for (int square = 0; square < 64; square++) {
				int f = file_of(square);
				int r = rank_of(square);
				int factor = (piece == PAWN) ? 8 : 4;
				if (f >= 4 && piece != PAWN)
					f = 7 - f;
				if (turn == WHITE)
					r = 7 - r;
				psqtable[turn][piece][square] = white_psqtable[piece - 1][factor * r + f] +
					piece_value[piece - 1];
			}
		}
	}

#ifndef NDEBUG
	tables_init_done = 1;
#endif
}
